# ==============================================================================
# | .htaccess for Gleam Project                                                |
# ==============================================================================

# ------------------------------------------------------------------------------
# | Rewrite Engine                                                             |
# ------------------------------------------------------------------------------

# Turn on the rewrite engine
<IfModule mod_rewrite.c>
    RewriteEngine On
    
    # If your site is in a subdirectory (e.g., /gleam), uncomment and adjust:
    # RewriteBase /gleam/
</IfModule>

# ------------------------------------------------------------------------------
# | Directory and File Handling                                                |
# ------------------------------------------------------------------------------

# Set default index file
DirectoryIndex index.html

# Disable directory browsing
Options -Indexes

# Protect .htaccess file
<Files .htaccess>
  Order allow,deny
  Deny from all
</Files>

# ------------------------------------------------------------------------------
# | Canonical URLs                                                             |
# ------------------------------------------------------------------------------

<IfModule mod_rewrite.c>
    # Force HTTPS
    RewriteCond %{HTTPS} off
    RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

    # Force non-www
    RewriteCond %{HTTP_HOST} ^www\.(.+)$ [NC]
    RewriteRule ^ https://%1%{REQUEST_URI} [L,R=301]

    # Remove .html extension from URLs
    # 1. Redirect requests for .html to the "clean" version
    RewriteCond %{THE_REQUEST} \s/+(.+?)\.html[\s?] [NC]
    RewriteRule ^ /%1 [R=301,L]

    # 2. Internally rewrite "clean" URLs to the .html file
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME}.html -f
    RewriteRule ^(.*)$ $1.html [L]
</IfModule>

# ------------------------------------------------------------------------------
# | Custom Error Pages                                                         |
# ------------------------------------------------------------------------------

# Define custom error pages
# IMPORTANT: If your site is in a subdirectory (e.g. /gleam), 
# you must include it in the path: /gleam/404.html
ErrorDocument 404 /404.html
ErrorDocument 500 /500.html

# ------------------------------------------------------------------------------
# | Performance: Caching and Compression                                       |
# ------------------------------------------------------------------------------

# Browser Caching
<IfModule mod_expires.c>
  ExpiresActive On
  ExpiresDefault                          "access plus 1 month"
  ExpiresByType text/css                  "access plus 1 year"
  ExpiresByType application/javascript    "access plus 1 year"
  ExpiresByType image/gif                 "access plus 1 month"
  ExpiresByType image/jpeg                "access plus 1 month"
  ExpiresByType image/png                 "access plus 1 month"
  ExpiresByType image/x-icon              "access plus 1 week"
  ExpiresByType font/woff                 "access plus 1 month"
  ExpiresByType font/woff2                "access plus 1 month"
  ExpiresByType text/html                 "access plus 0 seconds"
  ExpiresByType application/json          "access plus 0 seconds"
  ExpiresByType application/xml           "access plus 0 seconds"
</IfModule>

# Gzip compression
<IfModule mod_deflate.c>
  AddOutputFilterByType DEFLATE application/javascript
  AddOutputFilterByType DEFLATE application/rss+xml
  AddOutputFilterByType DEFLATE application/vnd.ms-fontobject
  AddOutputFilterByType DEFLATE application/x-font
  AddOutputFilterByType DEFLATE application/x-font-opentype
  AddOutputFilterByType DEFLATE application/x-font-otf
  AddOutputFilterByType DEFLATE application/x-font-truetype
  AddOutputFilterByType DEFLATE application/x-font-ttf
  AddOutputFilterByType DEFLATE application/x-javascript
  AddOutputFilterByType DEFLATE application/xhtml+xml
  AddOutputFilterByType DEFLATE application/xml
  AddOutputFilterByType DEFLATE font/opentype
  AddOutputFilterByType DEFLATE font/otf
  AddOutputFilterByType DEFLATE font/ttf
  AddOutputFilterByType DEFLATE image/svg+xml
  AddOutputFilterByType DEFLATE image/x-icon
  AddOutputFilterByType DEFLATE text/css  
  AddOutputFilterByType DEFLATE text/html
  AddOutputFilterByType DEFLATE text/javascript
  AddOutputFilterByType DEFLATE text/plain
  AddOutputFilterByType DEFLATE text/xml
</IfModule>

# ------------------------------------------------------------------------------
# | Security Headers                                                           |
# ------------------------------------------------------------------------------

<IfModule mod_headers.c>
    Header set X-Content-Type-Options "nosniff"
    Header set X-Frame-Options "SAMEORIGIN"
    Header set X-XSS-Protection "1; mode=block"
</IfModule>
